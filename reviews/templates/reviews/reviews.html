{% extends "base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% block content %}

<div class="row text-center">
  <h1>Reviews</h1>
  <div class="col-12 col-md-6 mt3 offset-md-3 text-center">
    
    {% for review in reviews %}
    <div class="p-2 
        {% if not review.approved and review.author == user %}
        faded{% elif not review.approved %} d-none{% endif %}">
        <div>
          <!-- Display a number of stars based on review score -->
{% if review.score == 1 %}
<i class="fa-solid fa-star"></i>
{% elif review.score == 2 %}
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
{% elif review.score == 3 %}
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
{% elif review.score == 4 %}
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
{% elif review.score == 5 %}
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
<i class="fa-solid fa-star"></i>
{% endif %}
        </div>
      
      <h3>{{ review.title}} </h3>
      
      <div id="review{{ review.id }}">
        {{ review.body | linebreaks }}
      </div>
      <p class="font-weight-bold"> Written by:
        {{ review.author }}
        <span class="font-weight-normal">
          {{ review.created_on }}
        </span>
      </p>
      {% if not review.approved and review.author == user %}
      <p class="approval">
        This review is awaiting approval
      </p>
      {% endif %}
      {% if user.is_authenticated and review.author == user %}
      <a href="{% url 'review_edit' review.id %}" class="edit_btn btn btn-success">Edit</a>      
      <form method="post" action="{% url 'review_delete' review.id %}" style="display: inline;">
        {% csrf_token %}
        <button type="submit" class="delete_btn btn btn-danger">Delete</button>
    </form>
      {% endif %}

    </div>
    {% endfor %}
  </div>
</div>
<!-- Creating New Review -->
<div class="col-md-4 col-12 offset-md-4 mt-3">
  <div class="card-body">
    {% if user.is_authenticated %}
    <h3>Leave a review:</h3>
    <p class="opacity">Posting as: {{ user.username }}</p>
    <form id="reviewForm" method="post" style="margin-top: 1.3em;">
      <div class="form-group d-inline">
        <h4>Rating:</h4>
        <div class="star-rating">
          {% for radio in review_form.score %}
            {{ radio.tag }}
            <label for="{{ radio.id_for_label }}"></label>
          {% endfor %}
        </div>
      </div>
      {% csrf_token %}
      {{ review_form.title|as_crispy_field }}
      {{ review_form.body|as_crispy_field }}
      <button id="submitButton" type="submit" class="btn btn-signup btn-lg">Submit</button>
    </form>
    {% else %}
    <p>Log in to leave a review</p>
    {% endif %}
  </div>
</div>

{% endblock %}